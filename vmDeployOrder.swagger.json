{
  "openapi":"3.0.3",
  "info":{
    "title":"vmDeployOrder",
    "description":"vmDeployOrder",
    "version":"1.0"
  },
  "tags":[
    {
      "name":"主机部署",
      "description":"vmDeployOrder"
    }
  ],
  "paths":{
    "/flow/organizations/{organizationId}/pipelines/{pipelineId}/deploy/{deployOrderId}/stop":{
      "put":{
        "tags":[
          "主机部署"
        ],
        "summary":"终止机器部署",
        "operationId":"StopVMDeployOrder",
        "description": "终止机器部署",
        "parameters":[
          {
            "name":"organizationId",
            "in":"path",
            "description":"企业Id",
            "example":"5ebbc0228123212b59xxxxx",
            "required":true,
            "style":"simple",
            "schema":{
              "type":"string"
            }
          },
          {
            "name":"pipelineId",
            "in":"path",
            "description":"流水线Id",
            "example":"123",
            "required":true,
            "style":"simple",
            "schema":{
              "type":"string"
            }
          },
          {
            "name":"deployOrderId",
            "in":"path",
            "description":"部署单Id",
            "example":"1111",
            "required":true,
            "style":"simple",
            "schema":{
              "type":"string"
            }
          }
        ],
        "responses":{
          "200":{
            "description":"成功",
            "content":{
              "*/*":{
                "schema":{
                  "name":"success",
                  "type":"boolean",
                  "example":true,
                  "description":"是否成功"
                }
              }
            }
          },
          "401":{
            "description":"Unauthorized"
          }
        }
      }
    },
    "/flow/organizations/{organizationId}/pipelines/{pipelineId}/deploy/{deployOrderId}/machine/{machineSn}/skip":{
      "put":{
        "tags":[
          "主机部署"
        ],
        "summary":"跳过机器部署",
        "operationId":"SkipVMDeployMachine",
        "description": "跳过机器部署",
        "parameters":[
          {
            "name":"organizationId",
            "in":"path",
            "description":"企业Id",
            "example":"5ebbc0228123212b59xxxxx",
            "required":true,
            "style":"simple",
            "schema":{
              "type":"string"
            }
          },
          {
            "name":"pipelineId",
            "in":"path",
            "description":"流水线Id",
            "example":"123",
            "required":true,
            "style":"simple",
            "schema":{
              "type":"string"
            }
          },
          {
            "name":"deployOrderId",
            "in":"path",
            "description":"部署单Id",
            "example":"1111",
            "required":true,
            "style":"simple",
            "schema":{
              "type":"string"
            }
          },
          {
            "name":"machineSn",
            "in":"path",
            "description":"机器sn",
            "example":"asssssssxsx",
            "required":true,
            "style":"simple",
            "schema":{
              "type":"string"
            }
          }
        ],
        "responses":{
          "200":{
            "description":"成功",
            "content":{
              "*/*":{
                "schema":{
                  "name":"success",
                  "type":"boolean",
                  "example":true,
                  "description":"是否成功"
                }
              }
            }
          },
          "401":{
            "description":"Unauthorized"
          }
        }
      }
    },
    "/flow/organizations/{organizationId}/pipelines/{pipelineId}/deploy/{deployOrderId}/machine/{machineSn}/retry":{
      "put":{
        "tags":[
          "主机部署"
        ],
        "summary":"重试机器部署",
        "operationId":"RetryVMDeployMachine",
        "description": "重试机器部署",
        "parameters":[
          {
            "name":"organizationId",
            "in":"path",
            "description":"企业Id",
            "example":"5ebbc0228123212b59xxxxx",
            "required":true,
            "style":"simple",
            "schema":{
              "type":"string"
            }
          },
          {
            "name":"pipelineId",
            "in":"path",
            "description":"流水线Id",
            "example":"123",
            "required":true,
            "style":"simple",
            "schema":{
              "type":"string"
            }
          },
          {
            "name":"deployOrderId",
            "in":"path",
            "description":"部署单Id",
            "example":"1111",
            "required":true,
            "style":"simple",
            "schema":{
              "type":"string"
            }
          },
          {
            "name":"machineSn",
            "in":"path",
            "description":"机器sn",
            "example":"asssssssxsx",
            "required":true,
            "style":"simple",
            "schema":{
              "type":"string"
            }
          }
        ],
        "responses":{
          "200":{
            "description":"成功",
            "content":{
              "*/*":{
                "schema":{
                  "name":"success",
                  "type":"boolean",
                  "example":true,
                  "description":"是否成功"
                }
              }
            }
          },
          "401":{
            "description":"Unauthorized"
          }
        }
      }
    },
    "/flow/organizations/{organizationId}/pipelines/{pipelineId}/deploy/{deployOrderId}/resume":{
      "put":{
        "tags":[
          "主机部署"
        ],
        "summary":"继续部署单运行",
        "operationId":"ResumeVMDeployOrder",
        "description": "继续部署单运行",
        "parameters":[
          {
            "name":"organizationId",
            "in":"path",
            "description":"企业Id",
            "example":"5ebbc0228123212b59xxxxx",
            "required":true,
            "style":"simple",
            "schema":{
              "type":"string"
            }
          },
          {
            "name":"pipelineId",
            "in":"path",
            "description":"流水线Id",
            "example":"123",
            "required":true,
            "style":"simple",
            "schema":{
              "type":"string"
            }
          },
          {
            "name":"deployOrderId",
            "in":"path",
            "description":"部署单Id",
            "example":"1111",
            "required":true,
            "style":"simple",
            "schema":{
              "type":"string"
            }
          }
        ],
        "responses":{
          "200":{
            "description":"成功",
            "content":{
              "*/*":{
                "schema":{
                  "name":"success",
                  "type":"boolean",
                  "example":true,
                  "description":"是否成功"
                }
              }
            }
          },
          "401":{
            "description":"Unauthorized"
          }
        }
      }
    },
    "/flow/organizations/{organizationId}/pipelines/{pipelineId}/deploy/{deployOrderId}":{
      "get":{
        "tags":[
          "主机部署"
        ],
        "summary":"获取部署单详情",
        "operationId":"GetVMDeployOrder",
        "description": "获取部署单详情",
        "parameters":[
          {
            "name":"organizationId",
            "in":"path",
            "description":"企业Id",
            "example":"5ebbc0228123212b59xxxxx",
            "required":true,
            "style":"simple",
            "schema":{
              "type":"string"
            }
          },
          {
            "name":"pipelineId",
            "in":"path",
            "description":"流水线id",
            "example":"123",
            "required":true,
            "style":"simple",
            "schema":{
              "type":"string"
            }
          },
          {
            "name":"deployOrderId",
            "in":"path",
            "description":"部署Id",
            "example":"1111",
            "required":true,
            "style":"simple",
            "schema":{
              "type":"string"
            }
          }
        ],
        "responses":{
          "200":{
            "description":"部署单详情",
            "content":{
              "*/*":{
                "schema":{
                  "type":"object",
                  "$ref":"#/components/schemas/DeployOrder"
                }
              }
            }
          },
          "401":{
            "description":"Unauthorized"
          }
        }
      }
    },
    "/flow/organizations/{organizationId}/pipelines/{pipelineId}/deploy/{deployOrderId}/machine/{machineSn}/log":{
      "get":{
        "tags":[
          "主机部署"
        ],
        "summary":" 查询机器部署日志",
        "operationId":"GetVMDeployMachineLog",
        "description": " 查询机器部署日志",
        "parameters":[
          {
            "name":"organizationId",
            "in":"path",
            "description":"企业Id",
            "example":"5ebbc0228123212b59xxxxx",
            "required":true,
            "style":"simple",
            "schema":{
              "type":"string"
            }
          },
          {
            "name":"pipelineId",
            "in":"path",
            "description":"流水线Id",
            "example":"123",
            "required":true,
            "style":"simple",
            "schema":{
              "type":"string"
            }
          },
          {
            "name":"deployOrderId",
            "in":"path",
            "description":"部署单Id",
            "example":"1111",
            "required":true,
            "style":"simple",
            "schema":{
              "type":"string"
            }
          },
          {
            "name":"machineSn",
            "in":"path",
            "description":"机器sn",
            "example":"asssssssxsx",
            "required":true,
            "style":"simple",
            "schema":{
              "type":"string"
            }
          }
        ],
        "responses":{
          "200":{
            "description":"机器部署日志",
            "content":{
              "*/*":{
                "schema":{
                  "type":"object",
                  "$ref":"#/components/schemas/DeployOrderLog"
                }
              }
            }
          },
          "401":{
            "description":"Unauthorized"
          }
        }
      }
    }
  },
  "components":{
    "schemas":{
      "DeployOrder":{
        "title":"DeployOrder",
        "type":"object",
        "properties":{
          "deployOrderId":{
            "type":"integer",
            "description":"部署单id",
            "format":"int64",
            "example":1111
          },
          "createTime":{
            "type":"integer",
            "description":"创建时间",
            "format":"int64",
            "example":1729178040000
          },
          "updateTime":{
            "type":"integer",
            "description":"更新时间",
            "format":"int64",
            "example":1729178040000
          },
          "creator":{
            "type":"string",
            "description":"创建人",
            "example":"ssaassa"
          },
          "currentBatch":{
            "type":"integer",
            "description":"当前发布批次",
            "example":2
          },
          "totalBatch":{
            "type":"integer",
            "description":"总发布批次",
            "example":3
          },
          "status":{
            "type":"string",
            "description":"发布状态 Waiting暂停 Running部署中 Cancelled已取消 Success成功",
            "example":"Success"
          },
          "exceptionCode":{
            "type":"string",
            "description":"错误码",
            "example":"500"
          },
          "actions":{
            "type":"array",
            "items":{
              "type":"object",
              "properties":{
                "type":{
                  "type":"string",
                  "description":"类型 StopVMDeployOrder 取消部署单 ResumeVMDeployOrder 继续部署单运行",
                  "example":"StopVMDeployOrder"
                },
                "disable":{
                  "type":"boolean",
                  "description":"当前用户是否有权限进行后续 action",
                  "example":true
                },
                "params":{
                  "type":"object",
                  "description":"参数",
                  "example":{}
                }
              }
            }
          },
          "deployMachineInfo":{
            "type":"object",
            "properties":{
              "hostGroupId":{
                "type":"integer",
                "description":"主机组Id",
                "format":"int64",
                "example":123
              },
              "batchNum":{
                "type":"integer",
                "description":"发布批次",
                "example":2
              },
              "deployMachines":{
                "type":"array",
                "items":{
                  "type":"object",
                  "properties":{
                    "createTime":{
                      "type":"integer",
                      "description":"创建时间",
                      "format":"int64",
                      "example":1729178040000
                    },
                    "updateTime":{
                      "type":"integer",
                      "description":"更新时间",
                      "format":"int64",
                      "example":1729178040000
                    },
                    "status":{
                      "type":"string",
                      "description":"状态 Success成功 Pending待部署 Running部署中 Cancelled取消 Queued部署等待中 Failed失败 Skipped已跳过",
                      "example":"Success"
                    },
                    "machineSn":{
                      "type":"string",
                      "description":"机器sn",
                      "example":"asssssssxsx"
                    },
                    "clientStatus":{
                      "type":"string",
                      "description":"机器状态 ok(正常) error(连接失败)",
                      "example":"ok"
                    },
                    "ip":{
                      "type":"string",
                      "description":"机器ip",
                      "example":"127.0.0.1"
                    },
                    "batchNum":{
                      "type":"integer",
                      "description":"部署批次",
                      "example":2
                    },
                    "actions":{
                      "type":"array",
                      "items":{
                        "type":"object",
                        "properties":{
                          "type":{
                            "type":"string",
                            "description":"类型 RetryVMDeployMachine重试机器部署 SkipVMDeployMachine跳过机器部署 LogVMDeployMachine查看机器部署日志",
                            "example":"RetryVMDeployMachine"
                          },
                          "disable":{
                            "type":"boolean",
                            "description":"当前用户是否有权限进行后续 action",
                            "example":true
                          },
                          "params":{
                            "type":"object",
                            "description":"参数",
                            "example":{}
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "DeployOrderLog":{
        "title":"DeployOrderLog",
        "type":"object",
        "properties":{
          "deployLog": {
            "type":"string",
            "description":"部署日志",
            "example":"success"
          },
          "aliyunRegion": {
            "type":"string",
            "description":"部署地域",
            "example":"cn-hangzhou"
          },
          "deployLogPath": {
            "type":"string",
            "description":"部署日志路径",
            "example":"/tmp/log"
          },
          "deployBeginTime": {
            "type":"string",
            "description":"部署开始时间",
            "example":"11111111111"
          },
          "deployEndTime": {
            "type":"string",
            "description":"部署结束时间",
            "example":"1719312026"
          }
        }
      }
    }
  },
  "security":[
    {
      "ApiKeyAuth":[
        "PERSONAL",
        "ORGANIZATION",
        "APPLICATION"
      ]
    }
  ]
}